

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Harpy &mdash; omc3 0.20.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=449bdd91" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=26ac6f1e"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model" href="model.html" />
    <link rel="prev" title="Definitions" href="definitions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/omc_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Main Entrypoints</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../entrypoints/analysis.html">Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/analysis.html#hole-in-one">Hole in One</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/analysis.html#amplitude-detuning-analysis">Amplitude Detuning Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../entrypoints/correction.html">Correction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/correction.html#global-correction">Global Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/correction.html#response-creator">Response Creator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/correction.html#correction-test">Correction Test</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../entrypoints/other.html">Other</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/other.html#tbt-converter">TbT Converter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/other.html#model-creator">Model Creator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/other.html#knob-extractor">Knob Extractor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/other.html#mad-x-wrapper">MAD-X Wrapper</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../entrypoints/plotting.html">Plotting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/plotting.html#plot-optics-measurements">Plot Optics Measurements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/plotting.html#plot-tfs">Plot TFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/plotting.html#plot-spectrum">Plot Spectrum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/plotting.html#plot-correction-test">Plot Correction Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/plotting.html#plot-amplitude-detuning-results">Plot Amplitude Detuning Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/plotting.html#plot-k-modulation-results">Plot K-Modulation Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/plotting.html#plot-bbq">Plot BBQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../entrypoints/scripts.html">Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/scripts.html#betabeat-src-output-converter">BetaBeat.src Output Converter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/scripts.html#import-k-modulation-results">Import K-Modulation Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/scripts.html#k-mod-luminosity-imbalance">K-Mod Luminosity Imbalance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/scripts.html#update-natural-tune-in-lin-files">Update Natural Tune in Lin-Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/scripts.html#write-mad-x-macros">Write MAD-X Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/scripts.html#fake-measurement-from-model">Fake Measurement from Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/scripts.html#linfile-cleaning">Linfile Cleaning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entrypoints/scripts.html#bad-bpms-summary">Bad BPMs Summary</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="correction.html">Correction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="correction.html#constants">Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="correction.html#filters">Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="correction.html#handler">Handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="correction.html#model-appenders">Model Appenders</a></li>
<li class="toctree-l2"><a class="reference internal" href="correction.html#model-diff">Model Diff</a></li>
<li class="toctree-l2"><a class="reference internal" href="correction.html#response-mad-x">Response MAD-X</a></li>
<li class="toctree-l2"><a class="reference internal" href="correction.html#response-twiss">Response TWISS</a></li>
<li class="toctree-l2"><a class="reference internal" href="correction.html#sequence-evaluation">Sequence Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="correction.html#response-matrix-io">Response Matrix IO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="definitions.html">Definitions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="definitions.html#constants">Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="definitions.html#formats">Formats</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Harpy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#clean">Clean</a></li>
<li class="toctree-l2"><a class="reference internal" href="#constants">Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="#frequency">Frequency</a></li>
<li class="toctree-l2"><a class="reference internal" href="#handler">Handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kicker">Kicker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="model.html#manager">Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#constants">Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#accelerator">Accelerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#esrf">ESRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#lhc">LHC</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#ps">PS</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#ps-booster">PS Booster</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#superkekb">SuperKEKB</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#iota">Iota</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#petra">PETRA</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#lhc-model-creator">LHC Model Creator</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#ps-model-creator">PS Model Creator</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#ps-booster-model-creator">PS Booster Model Creator</a></li>
<li class="toctree-l2"><a class="reference internal" href="model.html#segment-creator">Segment Creator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="optics_measurements.html">Optics Measurements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#measure-optics">Measure Optics</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#beta-from-amplitude">Beta from Amplitude</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#beta-from-phase">Beta from Phase</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#chromatic">Chromatic</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#constants">Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#combined-rdts">Combined RDTs</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#data-models">Data Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#dispersion">Dispersion</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#dpp">Dpp</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#isolation-forest">Isolation Forest</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#interaction-point">Interaction Point</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#kick">Kick</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#phase-advance">Phase Advance</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#resonance-driving-terms">Resonance Driving Terms</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#toolbox">Toolbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="optics_measurements.html#tune">Tune</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Plot-Subfunctions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="plotting.html#optics-measurements-plots">Optics Measurements Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="plotting.html#spectrum-plots">Spectrum Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="plotting.html#common-plot-functionality">Common Plot Functionality</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tune_analysis.html">Tune Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tune_analysis.html#constants">Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="tune_analysis.html#bbq-tools">BBQ Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="tune_analysis.html#fitting-tools">Fitting Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="tune_analysis.html#kick-file-modifiers">Kick File Modifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="tune_analysis.html#timber-extraction">Timber Extraction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a><ul>
<li class="toctree-l2"><a class="reference internal" href="utils.html#contexts">Contexts</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html#io-tools">IO Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html#logging-tools">Logging Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html#mock">Mock</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html#outliers">Outliers</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html#stats">Stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html#time-tools">Time Tools</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">omc3</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Harpy</li>
      <li class="wy-breadcrumbs-aside">
              <!-- User defined GitHub URL -->
              <a href="https://github.com/pylhc/omc3" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  <nav id="local-table-of-contents" role="navigation" aria-labelledby="local-table-of-contents-title">
    <h4 id="local-table-of-contents-title">On This Page</h4>
    <ul>
<li><a class="reference internal" href="#">Harpy</a><ul>
<li><a class="reference internal" href="#clean">Clean</a></li>
<li><a class="reference internal" href="#constants">Constants</a></li>
<li><a class="reference internal" href="#frequency">Frequency</a></li>
<li><a class="reference internal" href="#handler">Handler</a></li>
<li><a class="reference internal" href="#kicker">Kicker</a></li>
</ul>
</li>
</ul>

  </nav>
  
  
           <div itemprop="articleBody">
             
  <section id="harpy">
<h1>Harpy<a class="headerlink" href="#harpy" title="Link to this heading"></a></h1>
<section id="clean">
<h2>Clean<a class="headerlink" href="#clean" title="Link to this heading"></a></h2>
<p>This module contains the cleaning functionality of <code class="docutils literal notranslate"><span class="pre">harpy</span></code>.</p>
</section>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">omc3.harpy.clean.</span></span><span class="sig-name descname"><span class="pre">clean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">harpy_input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bpm_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/omc3/harpy/clean.html#clean"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Cleans BPM TbT matrix: removes BPMs not present in the model and based on specified cuts.
Also cleans the noise using singular value decomposition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>harpy_input</strong> -- The input object containing the analysis settings.</p></li>
<li><p><strong>bpm_data</strong> -- DataFrame of BPM TbT matrix indexed by BPM names.</p></li>
<li><p><strong>model</strong> -- model containing BPMs longitudinal locations indexed by BPM names.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Clean BPM matrix, its decomposition, bad BPMs summary and estimated BPM resolutions</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">omc3.harpy.clean.</span></span><span class="sig-name descname"><span class="pre">svd_decomposition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_singular_values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dominance_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/omc3/harpy/clean.html#svd_decomposition"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Computes reduced (K largest values) singular value decomposition of a matrix.
Requiring K singular values from MxN matrix results in matrices sized:
<cite>((M,K) x diag(K) x (K,N))</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>matrix</strong> -- matrix to be decomposed.</p></li>
<li><p><strong>num_singular_values</strong> -- Required number of singular values for reconstruction.</p></li>
<li><p><strong>dominance_limit</strong> -- limit on SVD dominance.</p></li>
<li><p><strong>num_iter</strong> -- maximal number of iteration to remove elements and renormalise matrices.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An indexed DataFrame of U matrix <cite>(M,K)</cite>,
the product of S and V^T matrices <cite>(diag(K).x(K,N))</cite>,
and the U matrix mask for cleaned elements.</p>
</dd>
</dl>
</dd></dl>

<section id="constants">
<h2>Constants<a class="headerlink" href="#constants" title="Link to this heading"></a></h2>
<p>Specific constants to be used in <code class="docutils literal notranslate"><span class="pre">harpy</span></code>, to help with consistency.</p>
</section>
<section id="frequency">
<h2>Frequency<a class="headerlink" href="#frequency" title="Link to this heading"></a></h2>
<p>This module contains the frequency calculations related functionality of <code class="docutils literal notranslate"><span class="pre">harpy</span></code>.</p>
<p>It provides functions to calculate the frequency spectra of turn-by-turn data.
This calculation is done using a combination of SVD decomposition zero_padded <cite>fft</cite> to speed up the
analysis.
Also searches for resonances in the calculated spectra.</p>
</section>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">omc3.harpy.frequency.</span></span><span class="sig-name descname"><span class="pre">clean_by_tune</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tunes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tune_clean_limit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Number</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Series</span></span></span><a class="reference internal" href="../_modules/omc3/harpy/frequency.html#clean_by_tune"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Looks for outliers in the tunes pandas Series and returns their indices.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tunes</strong> (<em>pd.Series</em>) -- Pandas series with the tunes per BPM and the BPM names as index.</p></li>
<li><p><strong>tune_clean_limit</strong> -- No BPM will find as outlier if its distance to the
average is lower than this limit.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">omc3.harpy.frequency.</span></span><span class="sig-name descname"><span class="pre">estimate_tunes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">harpy_input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">usvs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/omc3/harpy/frequency.html#estimate_tunes"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Estimates the tunes from the <cite>FFT</cite> of decomposed data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>harpy_input</strong> -- Analysis settings.</p></li>
<li><p><strong>usvs</strong> -- dictionary per plane of (U and SV^T matrices).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of estimated tunes [x, y, z].</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">omc3.harpy.frequency.</span></span><span class="sig-name descname"><span class="pre">find_resonances</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tunes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nturns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plane</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spectra</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_resonances</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/omc3/harpy/frequency.html#find_resonances"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Finds higher order lines in the spectra.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tunes</strong> -- list of tunes [x, y, z].</p></li>
<li><p><strong>nturns</strong> -- length of analysed data.</p></li>
<li><p><strong>plane</strong> -- marking the horizontal or vertical plane, <strong>X</strong> or <strong>Y</strong>.</p></li>
<li><p><strong>spectra</strong> -- frequencies and complex coefficients.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A DataFrame.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">omc3.harpy.frequency.</span></span><span class="sig-name descname"><span class="pre">get_freq_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">harpy_input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tunes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">auto_tol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/omc3/harpy/frequency.html#get_freq_mask"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Computes mask to get intervals around resonances in frequency domain.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>harpy_input</strong> -- A <cite>HarpyInput</cite> object.</p></li>
<li><p><strong>tunes</strong> -- list of tunes [x, y, z].</p></li>
<li><p><strong>auto_tol</strong> -- automatically calculated tolerance.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Boolean array.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">omc3.harpy.frequency.</span></span><span class="sig-name descname"><span class="pre">harpy_per_plane</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">harpy_input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bpm_matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">usv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tunes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plane</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/omc3/harpy/frequency.html#harpy_per_plane"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Calculates the spectra of TbT data, finds the main lines and cleans the BPMs for which the
main line hasn’t been found or is too far from its average over BPMs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>harpy_input</strong> -- Analysis settings.</p></li>
<li><p><strong>bpm_matrix</strong> -- TbT BPM matrix.</p></li>
<li><p><strong>usv</strong> -- U and SV^T matrices decomposed matrices, can be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>tunes</strong> -- list of tunes [x, y, z].</p></li>
<li><p><strong>plane</strong> -- marking the horizontal or vertical plane, <strong>X</strong> or <strong>Y</strong>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple of DataFrame (containing the main lines), Spectra, and Bad BPMs summary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">omc3.harpy.frequency.</span></span><span class="sig-name descname"><span class="pre">windowed_padded_rfft</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">harpy_input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tunes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">svd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/omc3/harpy/frequency.html#windowed_padded_rfft"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Calculates the spectra using specified windowing function and zero-padding.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>harpy_input</strong> -- A <cite>HarpyInput</cite> object.</p></li>
<li><p><strong>matrix</strong> -- <cite>pd.DataFrame</cite> of TbT matrix (BPMs x turns).</p></li>
<li><p><strong>tunes</strong> -- list of tunes [x, y, z].</p></li>
<li><p><strong>svd</strong> -- reduced (U_matrix, np.dot(S_matrix, V_matrix)) of original TbT matrix, defaults to
<code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple of <cite>pd.DataFrames</cite>, for frequencies and coefficients.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">omc3.harpy.frequency.</span></span><span class="sig-name descname"><span class="pre">windowing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hamming'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/omc3/harpy/frequency.html#windowing"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Provides specified windowing function of given length.</p>
<p>Currently, the following windowing functions are implemented (sorted by increasing width of
main lobe, also decreasing spectral leakage in closest lobes):
<code class="docutils literal notranslate"><span class="pre">rectangle</span></code>, <code class="docutils literal notranslate"><span class="pre">welch</span></code>, <code class="docutils literal notranslate"><span class="pre">triangle</span></code>, <code class="docutils literal notranslate"><span class="pre">hann</span></code>, <code class="docutils literal notranslate"><span class="pre">hamming</span></code>, <code class="docutils literal notranslate"><span class="pre">nuttal3</span></code>, and <code class="docutils literal notranslate"><span class="pre">nuttal4</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>length</strong> -- length of the window.</p></li>
<li><p><strong>window</strong> -- type of the windowing function.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Normalised windowing function of specified type and length.</p>
</dd>
</dl>
</dd></dl>

<section id="handler">
<h2>Handler<a class="headerlink" href="#handler" title="Link to this heading"></a></h2>
<p>This module contains high-level functions to manage most functionality of <code class="docutils literal notranslate"><span class="pre">harpy</span></code>.
Tools are provided to handle the cleaning, frequency analysis and resonance search for a
single-bunch <cite>TbtData</cite>.</p>
</section>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">omc3.harpy.handler.</span></span><span class="sig-name descname"><span class="pre">run_per_bunch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tbt_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">harpy_input</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/omc3/harpy/handler.html#run_per_bunch"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Cleans data, analyses frequencies and searches for resonances.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tbt_data</strong> -- single bunch <cite>TbtData</cite>.</p></li>
<li><p><strong>harpy_input</strong> -- Analysis settings taken from the commandline.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary with a <cite>TfsDataFrame</cite> per plane.</p>
</dd>
</dl>
</dd></dl>

<section id="kicker">
<h2>Kicker<a class="headerlink" href="#kicker" title="Link to this heading"></a></h2>
<p>This module contains phase correction functionality of <code class="docutils literal notranslate"><span class="pre">harpy</span></code>.
It provides tools to correct phases of a main spectral line in a case where damped (exponentially
decaying) oscillations are analysed.</p>
</section>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">omc3.harpy.kicker.</span></span><span class="sig-name descname"><span class="pre">phase_correction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bpm_data_orig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lin_frame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plane</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/omc3/harpy/kicker.html#phase_correction"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Corrects phase of main spectral line assuming exponentially decaying oscillations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bpm_data_orig</strong> -- matrix of original <cite>TbtData</cite>.</p></li>
<li><p><strong>lin_frame</strong> -- DataFrame in which to correct the results.</p></li>
<li><p><strong>plane</strong> -- marking the horizontal or vertical plane, <strong>X</strong> or <strong>Y</strong>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A <cite>DataFrame</cite> with corrected phases.</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="definitions.html" class="btn btn-neutral float-left" title="Definitions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="model.html" class="btn btn-neutral float-right" title="Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>